<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club TRIAX - 戦略と情熱が交差する場所</title>
    <meta name="description" content="Club TRIAX 公式ホームページ。アメリカンフットボールクラブの最新情報、メンバー紹介、試合スケジュールをお届けします。">
    
    <!-- OGP -->
    <meta property="og:title" content="Club TRIAX">
    <meta property="og:description" content="戦略と情熱が交差する場所">
    <meta property="og:image" content="assets/ogp/default.jpg">
    <meta property="og:type" content="website">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        html {
            scroll-behavior: smooth;
        }
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* 画像読み込み中のスタイル */
        .member-image {
            background-color: #e5e7eb;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50%" y="50%" text-anchor="middle" dy=".3em" fill="%239ca3af" font-family="sans-serif" font-size="14">Loading...</text></svg>');
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
</head>
<body class="bg-white text-gray-900">
    <!-- Navigation -->
    <nav class="fixed top-0 right-0 left-0 z-50 bg-white/90 backdrop-blur-md shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <a href="#" class="font-bold text-xl">Club TRIAX</a>
                <button id="menu-toggle" class="md:hidden p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <div class="hidden md:flex space-x-8">
                    <a href="#hero" class="hover:text-red-600 transition-colors">TOP</a>
                    <a href="#news" class="hover:text-red-600 transition-colors">NEWS</a>
                    <a href="#members" class="hover:text-red-600 transition-colors">MEMBERS</a>
                    <a href="#schedule" class="hover:text-red-600 transition-colors">SCHEDULE</a>
                    <a href="#about" class="hover:text-red-600 transition-colors">ABOUT</a>
                    <a href="#contact" class="hover:text-red-600 transition-colors">CONTACT</a>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <div class="px-4 py-2 space-y-2">
                <a href="#hero" class="block py-2 hover:text-red-600">TOP</a>
                <a href="#news" class="block py-2 hover:text-red-600">NEWS</a>
                <a href="#members" class="block py-2 hover:text-red-600">MEMBERS</a>
                <a href="#schedule" class="block py-2 hover:text-red-600">SCHEDULE</a>
                <a href="#about" class="block py-2 hover:text-red-600">ABOUT</a>
                <a href="#contact" class="block py-2 hover:text-red-600">CONTACT</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero" class="h-screen relative overflow-hidden">
        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('assets/headers/TOP.jpg')">
            <div class="absolute inset-0 bg-black bg-opacity-40"></div>
        </div>
        <div class="relative z-10 flex flex-col items-center justify-center h-full text-white px-4">
            <img src="assets/triax-logo.png" alt="Club TRIAX" class="w-48 md:w-64 mb-8">
            <h1 class="text-3xl md:text-5xl font-bold mb-4 text-center">戦略と情熱が交差する場所</h1>
            <button onclick="document.getElementById('news').scrollIntoView({behavior: 'smooth'})" class="mt-8 px-8 py-3 bg-red-600 hover:bg-red-700 rounded-full transition-colors">
                最新情報を見る
            </button>
        </div>
    </section>

    <!-- NEWS Section -->
    <section id="news" class="py-20 bg-gray-50">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 fade-in">NEWS</h2>
            <div class="grid md:grid-cols-3 gap-8 mb-8">
                <!-- Instagram埋め込みプレースホルダー -->
                <div class="bg-white rounded-lg shadow-lg p-6 fade-in">
                    <div class="bg-gray-200 h-64 rounded mb-4 flex items-center justify-center">
                        <span class="text-gray-500">Instagram Post 1</span>
                    </div>
                    <p class="text-sm text-gray-600">最新の投稿がここに表示されます</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 fade-in">
                    <div class="bg-gray-200 h-64 rounded mb-4 flex items-center justify-center">
                        <span class="text-gray-500">Instagram Post 2</span>
                    </div>
                    <p class="text-sm text-gray-600">最新の投稿がここに表示されます</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 fade-in">
                    <div class="bg-gray-200 h-64 rounded mb-4 flex items-center justify-center">
                        <span class="text-gray-500">Instagram Post 3</span>
                    </div>
                    <p class="text-sm text-gray-600">最新の投稿がここに表示されます</p>
                </div>
            </div>
            <div class="text-center">
                <a href="https://www.instagram.com/clubtriax/" target="_blank" class="inline-flex items-center text-red-600 hover:text-red-700 font-medium">
                    もっと見る
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- MEMBERS Section -->
    <section id="members" class="py-20">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 fade-in">MEMBERS</h2>
            
            <!-- Position Filter -->
            <div class="flex flex-wrap justify-center gap-2 mb-8 fade-in">
                <button class="position-filter px-4 py-2 rounded-full bg-red-600 text-white" data-position="ALL">ALL</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="QB">QB</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="RB">RB</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="WR">WR</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="TE">TE</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="OL">OL</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="DL">DL</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="LB">LB</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="DB">DB</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="K">K</button>
                <button class="position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300" data-position="P">P</button>
            </div>
            
            <!-- Members Grid -->
            <div id="members-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- メンバーカードはJavaScriptで動的に生成 -->
            </div>
        </div>
    </section>

    <!-- SCHEDULE Section -->
    <section id="schedule" class="py-20 bg-gray-50">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center mb-12 fade-in">SCHEDULE</h2>
            <div class="max-w-2xl mx-auto space-y-4 mb-8">
                <div class="bg-white rounded-lg shadow p-6 fade-in">
                    <div class="flex justify-between items-start flex-wrap gap-2">
                        <div>
                            <p class="font-bold text-lg">2025年9月15日（日）</p>
                            <p class="text-gray-600">vs. チームA</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">会場: 横浜スタジアム</p>
                            <p class="text-sm text-gray-500">14:00 キックオフ</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 fade-in">
                    <div class="flex justify-between items-start flex-wrap gap-2">
                        <div>
                            <p class="font-bold text-lg">2025年9月29日（日）</p>
                            <p class="text-gray-600">vs. チームB</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">会場: 川崎球場</p>
                            <p class="text-sm text-gray-500">13:00 キックオフ</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 fade-in">
                    <div class="flex justify-between items-start flex-wrap gap-2">
                        <div>
                            <p class="font-bold text-lg">2025年10月13日（日）</p>
                            <p class="text-gray-600">vs. チームC</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">会場: 横浜スタジアム</p>
                            <p class="text-sm text-gray-500">14:00 キックオフ</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <a href="#" class="inline-flex items-center text-red-600 hover:text-red-700 font-medium">
                    全スケジュールを見る
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- ABOUT Section -->
    <section id="about" class="py-20">
        <div class="container mx-auto px-4 max-w-4xl">
            <h2 class="text-4xl font-bold text-center mb-12 fade-in">ABOUT TRIAX</h2>
            <div class="text-center mb-8 fade-in">
                <p class="text-lg leading-relaxed mb-8">
                    Club TRIAXは、戦略性と情熱を兼ね備えたアメリカンフットボールクラブです。
                    多様なバックグラウンドを持つメンバーが集い、互いに高め合いながら、
                    フィールドで最高のパフォーマンスを追求しています。
                </p>
            </div>
            <div class="grid md:grid-cols-2 gap-8 fade-in">
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="font-bold text-lg mb-4">チーム情報</h3>
                    <dl class="space-y-2">
                        <div class="flex justify-between">
                            <dt class="text-gray-600">創立年</dt>
                            <dd class="font-medium">2015年</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-gray-600">所属リーグ</dt>
                            <dd class="font-medium">関東社会人リーグ</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-gray-600">ホームグラウンド</dt>
                            <dd class="font-medium">横浜市内各所</dd>
                        </div>
                    </dl>
                </div>
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="font-bold text-lg mb-4">活動情報</h3>
                    <dl class="space-y-2">
                        <div class="flex justify-between">
                            <dt class="text-gray-600">練習日</dt>
                            <dd class="font-medium">土曜・日曜</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-gray-600">練習時間</dt>
                            <dd class="font-medium">9:00-12:00</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-gray-600">メンバー数</dt>
                            <dd class="font-medium">約40名</dd>
                        </div>
                    </dl>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTACT Section -->
    <section id="contact" class="py-20 bg-gray-50">
        <div class="container mx-auto px-4 max-w-2xl text-center">
            <h2 class="text-4xl font-bold mb-12 fade-in">CONTACT</h2>
            <div class="space-y-8 fade-in">
                <div>
                    <a href="#" class="inline-block px-8 py-3 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors mb-4">
                        入部希望の方はこちら
                    </a>
                    <p class="text-sm text-gray-600">見学・体験も随時受け付けています</p>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">SNS</h3>
                    <div class="flex justify-center space-x-6">
                        <a href="https://www.instagram.com/club_triax/" target="_blank" class="text-gray-600 hover:text-red-600 transition-colors">
                            <span class="sr-only">Instagram</span>
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-red-600 transition-colors">
                            <span class="sr-only">X (Twitter)</span>
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-red-600 transition-colors">
                            <span class="sr-only">Facebook</span>
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-2">お問い合わせ</h3>
                    <a href="mailto:info@club-triax.com" class="text-red-600 hover:text-red-700">
                        info@club-triax.com
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-sm mb-4 md:mb-0">&copy; 2025 Club TRIAX. All rights reserved.</p>
                <div class="flex space-x-6 text-sm">
                    <a href="#" class="hover:text-red-400 transition-colors">プライバシーポリシー</a>
                    <a href="#" class="hover:text-red-400 transition-colors">サイトマップ</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Member Detail Modal -->
    <div id="member-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <button id="close-modal" class="float-right text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    <div id="modal-content">
                        <!-- モーダルコンテンツはJavaScriptで動的に生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // グローバル変数
        let allMembers = [];
        let currentPosition = 'ALL';
        let extensionAttempts = {};
        let imageMapping = {};

        // 画像マッピングを読み込む
        async function loadImageMapping() {
            try {
                const response = await fetch('image-mapping.json');
                if (response.ok) {
                    imageMapping = await response.json();
                    console.log('Image mapping loaded:', Object.keys(imageMapping).length, 'entries');
                }
            } catch (error) {
                console.warn('Could not load image mapping:', error);
            }
        }

        // Google Drive IDを抽出
        function extractGoogleDriveId(url) {
            const match = url.match(/id=([^&]+)/);
            return match ? match[1] : null;
        }

        // 画像エラーハンドリング
        function handleImageError(img) {
            const googleDriveId = img.dataset.googleDriveId;
            if (!googleDriveId) {
                img.src = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23e5e7eb%22 width=%22100%22 height=%22100%22/><text x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%239ca3af%22 font-family=%22sans-serif%22 font-size=%2216%22>No Image</text></svg>';
                return;
            }

            // 試した拡張子を記録
            if (!extensionAttempts[googleDriveId]) {
                extensionAttempts[googleDriveId] = [];
            }

            const extensions = ['jpg', 'png', 'gif', 'webp', 'heif', 'heic'];
            const currentSrc = img.src;
            const currentExt = currentSrc.split('.').pop();
            
            extensionAttempts[googleDriveId].push(currentExt);
            
            // 次の拡張子を試す
            const nextExt = extensions.find(ext => !extensionAttempts[googleDriveId].includes(ext));
            if (nextExt) {
                img.src = `assets/members/${googleDriveId}.${nextExt}`;
            } else {
                // すべての拡張子を試した場合はプレースホルダー
                img.src = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23e5e7eb%22 width=%22100%22 height=%22100%22/><text x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%239ca3af%22 font-family=%22sans-serif%22 font-size=%2216%22>No Image</text></svg>';
            }
        }

        // MIMEタイプから拡張子を取得
        function getExtensionFromMimeType(mimeType) {
            const mimeToExt = {
                'image/jpeg': 'jpg',
                'image/jpg': 'jpg',
                'image/png': 'png',
                'image/gif': 'gif',
                'image/webp': 'webp',
                'image/svg+xml': 'svg',
                'image/heif': 'heif',
                'image/heic': 'heic'
            };
            return mimeToExt[mimeType] || 'jpg';
        }

        // Google Drive URLを画像表示用に変換（新しいAPI形式対応）
        function convertGoogleDriveUrl(urlOrObject) {
            // 新しいAPI形式（オブジェクト）の場合
            if (typeof urlOrObject === 'object' && urlOrObject.url) {
                const googleDriveId = extractGoogleDriveId(urlOrObject.url);
                if (googleDriveId) {
                    const extension = getExtensionFromMimeType(urlOrObject.mime_type);
                    return `assets/members/${googleDriveId}.${extension}`;
                }
                return urlOrObject.url;
            }
            
            // 旧形式（文字列URL）の場合
            const googleDriveId = extractGoogleDriveId(urlOrObject);
            if (googleDriveId && imageMapping[googleDriveId]) {
                // マッピングから正しいファイル名を取得
                return `assets/members/${imageMapping[googleDriveId]}`;
            } else if (googleDriveId) {
                // マッピングがない場合はデフォルトでjpgを試す
                return `assets/members/${googleDriveId}.jpg`;
            }
            return urlOrObject;
        }

        // メンバーデータ取得
        async function fetchRoster() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/triax/roster-api/refs/heads/main/data/roster.json');
                const data = await response.json();
                
                // 画像URLを変換
                if (data && data.members) {
                    data.members.forEach(member => {
                        if (member.photos && member.photos.serious) {
                            member.photos.serious = convertGoogleDriveUrl(member.photos.serious);
                        }
                    });
                }
                
                return data;
            } catch (error) {
                console.error('Failed to fetch roster:', error);
                return null;
            }
        }

        // メンバーカード作成
        function createMemberCard(member) {
            const card = document.createElement('div');
            card.className = 'member-card bg-white rounded-lg shadow-lg overflow-hidden cursor-pointer hover:shadow-xl transition-shadow fade-in';
            const seriousPhotoUrl = member.photos.serious.url || member.photos.serious;
            const googleDriveId = extractGoogleDriveId(seriousPhotoUrl);
            
            card.innerHTML = `
                <div class="aspect-square bg-gray-200 relative overflow-hidden">
                    <img data-src="${member.photos.serious}" 
                         data-google-drive-id="${googleDriveId || ''}"
                         alt="${member.name.default}" 
                         class="lazy-load w-full h-full object-cover member-image"
                         onerror="handleImageError(this)">
                    ${member.jersey ? `<div class="absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-sm">
                        #${member.jersey}
                    </div>` : ''}
                </div>
                <div class="p-4">
                    <h3 class="font-bold text-lg mb-1">${member.name.default}</h3>
                    <p class="text-red-600 font-semibold">${member.position}</p>
                    ${member.role ? `<p class="text-sm text-gray-600 mt-1">${member.role}</p>` : ''}
                </div>
            `;
            
            // クリックイベント
            card.addEventListener('click', () => showMemberDetail(member));
            
            return card;
        }

        // メンバー詳細モーダル表示
        function showMemberDetail(member) {
            const modalContent = document.getElementById('modal-content');
            const seriousPhotoUrl = member.photos.serious.url || member.photos.serious;
            const googleDriveId = extractGoogleDriveId(seriousPhotoUrl);
            
            modalContent.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <img src="${convertGoogleDriveUrl(member.photos.serious)}" 
                             data-google-drive-id="${googleDriveId || ''}"
                             alt="${member.name.default}" 
                             class="w-full rounded-lg" 
                             onerror="handleImageError(this)">
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold mb-2">${member.name.default}</h3>
                        ${member.name.hiragana ? `<p class="text-gray-600 mb-1">${member.name.hiragana}</p>` : ''}
                        ${member.name.alphabet ? `<p class="text-gray-600 mb-4">${member.name.alphabet}</p>` : ''}
                        
                        <div class="flex items-center gap-4 mb-6">
                            <span class="bg-red-600 text-white px-3 py-1 rounded-full font-bold">#${member.jersey}</span>
                            <span class="font-semibold text-lg">${member.position}</span>
                            ${member.role ? `<span class="text-gray-600">${member.role}</span>` : ''}
                        </div>
                        
                        <dl class="space-y-3">
                            ${member.university ? `
                                <div>
                                    <dt class="font-semibold text-gray-700">出身大学</dt>
                                    <dd>${member.university}</dd>
                                </div>
                            ` : ''}
                            ${member.enthusiasm ? `
                                <div>
                                    <dt class="font-semibold text-gray-700">意気込み</dt>
                                    <dd>${member.enthusiasm}</dd>
                                </div>
                            ` : ''}
                            ${member.watchme ? `
                                <div>
                                    <dt class="font-semibold text-gray-700">注目ポイント</dt>
                                    <dd>${member.watchme}</dd>
                                </div>
                            ` : ''}
                            ${member.hobbies ? `
                                <div>
                                    <dt class="font-semibold text-gray-700">趣味</dt>
                                    <dd>${member.hobbies}</dd>
                                </div>
                            ` : ''}
                            ${member.favorite ? `
                                <div>
                                    <dt class="font-semibold text-gray-700">お気に入り</dt>
                                    <dd>${member.favorite}</dd>
                                </div>
                            ` : ''}
                            ${member.what_i_like_about_triax ? `
                                <div>
                                    <dt class="font-semibold text-gray-700">TRIAXの好きなところ</dt>
                                    <dd>${member.what_i_like_about_triax}</dd>
                                </div>
                            ` : ''}
                        </dl>
                    </div>
                </div>
            `;
            
            document.getElementById('member-modal').classList.remove('hidden');
        }

        // ポジションフィルター
        function filterByPosition(position) {
            currentPosition = position;
            displayMembers();
            
            // ボタンのスタイル更新
            document.querySelectorAll('.position-filter').forEach(btn => {
                if (btn.dataset.position === position) {
                    btn.className = 'position-filter px-4 py-2 rounded-full bg-red-600 text-white';
                } else {
                    btn.className = 'position-filter px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300';
                }
            });
        }

        // メンバー表示
        function displayMembers() {
            const container = document.getElementById('members-container');
            container.innerHTML = '';
            
            const filteredMembers = currentPosition === 'ALL' 
                ? allMembers 
                : allMembers.filter(m => m.position === currentPosition);
            
            filteredMembers.forEach(member => {
                container.appendChild(createMemberCard(member));
            });
            
            // 遅延読み込みを再初期化
            initLazyLoad();
        }

        // 遅延読み込み
        function initLazyLoad() {
            const images = document.querySelectorAll('.lazy-load');
            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.add('loaded');
                        
                        // エラーハンドリングを追加
                        img.onerror = function() {
                            console.error(`Failed to load image: ${img.dataset.src}`);
                            this.onerror = null;
                            this.src = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23e5e7eb%22 width=%22100%22 height=%22100%22/><text x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%239ca3af%22 font-family=%22sans-serif%22 font-size=%2216%22>No Image</text></svg>';
                        };
                        
                        imageObserver.unobserve(img);
                    }
                });
            });
            
            images.forEach(img => imageObserver.observe(img));
        }

        // フェードインアニメーション
        function initFadeIn() {
            const elements = document.querySelectorAll('.fade-in');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });
            
            elements.forEach(el => observer.observe(el));
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', async function() {
            // 画像マッピングを最初に読み込む
            await loadImageMapping();
            // メニュートグル
            document.getElementById('menu-toggle').addEventListener('click', function() {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });
            
            // モバイルメニューのリンククリックで閉じる
            document.querySelectorAll('#mobile-menu a').forEach(link => {
                link.addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.add('hidden');
                });
            });
            
            // モーダル閉じる
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('member-modal').classList.add('hidden');
            });
            
            document.getElementById('member-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });
            
            // ポジションフィルター
            document.querySelectorAll('.position-filter').forEach(btn => {
                btn.addEventListener('click', () => filterByPosition(btn.dataset.position));
            });
            
            // メンバーデータ取得
            const rosterData = await fetchRoster();
            if (rosterData && rosterData.members) {
                allMembers = rosterData.members;
                displayMembers();
            } else {
                document.getElementById('members-container').innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-gray-500">メンバー情報の取得に失敗しました</p>
                    </div>
                `;
            }
            
            // アニメーション初期化
            initFadeIn();
        });
    </script>
</body>
</html>